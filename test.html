<!DOCTYPE html>
<html>
    <head>
        <style>
            h1{
                margin:0;
                font-size:1.5em;
            }
            .summary h1{
                font-size:4em;
            }
            .passed h1{
                color: #0A0;
            }
            .failed h1{
                color: #A00;
            }     
            .test .description{
                height:0px;
                overflow:scroll;
                -webkit-transition:height 0.2s linear;
                -moz-transition:height 0.2s linear;
                -ms-transition:height 0.2s linear;
                transition:height 0.2s linear;
            }
            .test:hover .description{
                height:200px;            
            }
        </style>
        <script src="../crel/crel.js"></script>
        <script src="doc.js"></script>
        <script>
        window.onload = function(){

            var testArea = document.querySelectorAll('.testArea')[0];

            var tests = [
                {
                    name: "find",
                    test: function(){
                        testArea.appendChild(crel('div', {'class':'things'}));

                        var result = doc.find('.things');
                        
                        this.result = result.length;
                    },
                    expected: 1
                },
                {
                    name: "find with query reference",
                    test: function(){
                        testArea.appendChild(crel('div', {'class':'things'}));

                        var result = doc.find('.testArea', '.things');
                        
                        this.result = result.length;
                    },
                    expected: 1
                },
                {
                    name: "find with node reference",
                    test: function(){
                        testArea.appendChild(crel('div', {'class':'things'}));

                        var result = doc.find(testArea, '.things');
                        
                        this.result = result.length;
                    },
                    expected: 1
                },
                {
                    name: "is",
                    test: function(){
                        
                        this.result = doc.is(testArea, '.testArea');
                    },
                    expected: true
                },
                {
                    name: "isnt..",
                    test: function(){
                        
                        this.result = doc.is(testArea, '.something');
                    },
                    expected: false
                },
                {
                    name: "closest with node",
                    test: function(){
                        testArea.appendChild(crel('div', {'class':'things'}));

                        var result = doc.closest(doc.find('.things')[0], testArea);
                        
                        this.result = result;
                    },
                    expected: testArea
                },
                {
                    name: "closest with query",
                    test: function(){
                        testArea.appendChild(crel('div', {'class':'things'}));

                        var result = doc.closest(doc.find('.things')[0], '.testArea');
                        
                        this.result = result;
                    },
                    expected: testArea
                },
                {
                    name: "closest document",
                    test: function(){
                        var result = doc.closest(document, document);
                        
                        this.result = result;
                    },
                    expected: document
                },
                {
                    name: "on click",
                    test: function(){
                        var test = this;

                        testArea.appendChild(crel('div', {'class':'things'}));

                        var result = doc.on('click', '.things', function(){
                            test.result = true;
                        });

                        doc.find('.things')[0].click();
                    },
                    expected: true
                },
                {
                    name: "on click delegated",
                    test: function(){
                        var test = this;

                        testArea.appendChild(
                            crel('div',
                                crel('div', {'class':'delegate'},
                                    crel('div', {'class':'thing'})
                                ),
                                crel('div', {'class':'thing'})
                            )
                        );

                        this.result = 0;

                        var result = doc.on('click', '.thing', function(){
                            test.result++;
                        }, '.delegate');

                        doc.find('.thing')[0].click();
                        doc.find('.thing')[1].click();
                    },
                    expected: 1
                }
            ];
            
            var resultsElement = document.getElementsByClassName('results')[0];

            function runTests(){
                var errors = [],
                    passed = 0,
                    startTime = new Date();
                    
                for(var i = 0; i < tests.length; i++){
                    var test = tests[i],
                        resultElement,
                        title,
                        runBtn,
                        result,
                        description,
                        hasError = false;
                    
                    try{
                        test.test.call(test);
                    }catch(error){
                        errors.push(error.toString());
                        hasError = true;
                    }
                    test.passed = test.result === test.expected && !hasError;
                    
                    test.passed && passed++;

                    testArea.innerHTML = '';
                    
                    resultElement = crel('div', {'class':(test.passed && 'passed' || 'failed') + ' test'},
                        (title = crel('h1', test.name + ' ' + (test.passed && 'passed' || 'failed'))),
                        (result = crel('span', {'class':'result'}), 'output: ' + test.result + ', expected: ' + test.expected),
                        (runBtn = crel('button', {type:'button'}, 'Run again')),
                        (description = crel('pre', {'class':'description'}, test.test.toString()))
                    );
                    
                    (function(test){
                        runBtn.addEventListener('click', function(){
                            test.test.call(test);
                        });
                    })(test);
                    
                    resultsElement.appendChild(resultElement);
                }
                
                console.log('Runtime: ' + (new Date() - startTime));
                
                for(var i = 0; i < errors.length; i++){
                    console.error(errors[i]);
                }
                
                return passed;
            }
            
            
            
            var summaryElement = document.getElementsByClassName('summary')[0],
                passed = runTests();
                failed = tests.length - passed;
            
            summaryElement.appendChild(crel('h1', passed + ' Tests passed, ' + failed + ' Tests failed'));
            summaryElement.setAttribute('class',(!failed?'passed':'failed') + ' summary');
        };

        </script>
    </head>
    <body>
        <div class="testArea"></div>
        <div class="results">
            <div class="summary"></div>
        </div>
    </body>
</html>